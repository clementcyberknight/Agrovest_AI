<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agrovest</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      rel="icon"
      sizes="64x64"
      href="images/AgroVest (2).png"
      type="image/x-png"
    />
    <style>
      .agrovest-green {
        background-color: #1b4d2e;
      }
      .agrovest-text-green {
        color: #1b4d2e;
      }
      .crop-button {
        transition: all 0.2s;
      }
      .crop-button.selected {
        background-color: #dcfce7;
        border-color: #22c55e;
        color: #166534;
      }
      .crop-button .checkbox {
        width: 16px;
        height: 16px;
        border: 2px solid #d1d5db;
        border-radius: 4px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-right: 8px;
      }
      .crop-button.selected .checkbox {
        background-color: #22c55e;
        border-color: #22c55e;
      }
      .crop-button .check-icon {
        display: none;
        color: white;
        font-size: 12px;
      }
      .crop-button.selected .check-icon {
        display: inline;
      }
      .success-alert {
        display: none;
        animation: fadeIn 0.3s ease-in;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .spinner {
        animation: spin 1s linear infinite;
        display: none;
      }
      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <nav class="agrovest-green p-2 flex justify-between items-center">
      <img src="images/Logo.png" alt="Agrovest Logo" class="h-12" />
      <a
        href="index.html"
        class="text-yellow-100 text-center text-xl hidden md:inline"
        >Home</a
      >
    </nav>

    <div
      class="container mx-auto mt-8 p-6 bg-white rounded-lg shadow-md max-w-xl"
    >
      <h1 class="text-3xl font-bold text-center agrovest-text-green mb-6">
        Tell Us More About You
      </h1>
      <p class="text-center mb-6">
        This information helps us provide you with a personalized experience.
      </p>

      <form id="profileForm" class="space-y-4">
        <div class="mb-4">
          <label for="fullName" class="block text-gray-700 font-bold mb-2"
            >Full Name</label
          >
          <input
            type="text"
            id="fullName"
            name="fullName"
            required
            class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"
          />
        </div>

        <div class="mb-4">
          <label for="dob" class="block text-gray-700 font-bold mb-2"
            >Date of Birth</label
          >
          <input
            type="date"
            id="dob"
            name="dob"
            required
            class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"
          />
        </div>

        <div class="mb-4">
          <label class="block text-gray-700 font-bold mb-2"
            >Crops Planted</label
          >
          <div id="cropsContainer" class="grid grid-cols-2 gap-2">
            <!-- Crops will be populated by JavaScript -->
          </div>
        </div>

        <div class="mb-4">
          <label for="farmAddress" class="block text-gray-700 font-bold mb-2"
            >Farm Address</label
          >
          <input
            type="text"
            id="farmAddress"
            name="farmAddress"
            required
            class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"
          />
        </div>

        <div class="mb-4">
          <label for="city" class="block text-gray-700 font-bold mb-2"
            >City</label
          >
          <input
            type="text"
            id="city"
            name="city"
            required
            class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"
          />
        </div>

        <div class="mb-4">
          <label for="state" class="block text-gray-700 font-bold mb-2"
            >State</label
          >
          <select
            id="state"
            name="state"
            required
            class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"
          >
            <option value="Abia">Abia</option>
            <option value="Akwa Ibom">Akwa Ibom</option>
            <option value="Adamawa">Adamawa</option>
            <option value="Bauchi">Bauchi</option>
            <option value="Bayelsa">Bayelsa</option>
            <option value="Benue">Benue</option>
            <option value="Borno">Borno</option>
            <option value="Cross River">Cross River</option>
            <option value="Delta">Delta</option>
            <option value="Ebonyi">Ebonyi</option>
            <option value="Edo">Edo</option>
            <option value="Ekiti">Ekiti</option>
            <option value="Enugu">Enugu</option>
            <option value="FCT">FCT</option>
            <option value="Gombe">Gombe</option>
            <option value="Imo">Imo</option>
            <option value="Jigawa">Jigawa</option>
            <option value="Kaduna">Kaduna</option>
            <option value="Kano">Kano</option>
            <option value="Katsina">Katsina</option>
            <option value="Kebbi">Kebbi</option>
            <option value="Kogi">Kogi</option>
            <option value="Kwara">Kwara</option>
            <option value="Lagos">Lagos</option>
            <option value="Nasarawa">Nasarawa</option>
            <option value="Niger">Niger</option>
            <option value="Ogun">Ogun</option>
            <option value="Ondo">Ondo</option>
            <option value="Osun">Osun</option>
            <option value="Oyo">Oyo</option>
            <option value="Plateau">Plateau</option>
            <option value="Rivers">Rivers</option>
            <option value="Sokoto">Sokoto</option>
            <option value="Taraba">Taraba</option>
            <option value="Yobe">Yobe</option>
            <option value="Zamfara">Zamfara</option>
          </select>
        </div>

        <button
          type="submit"
          id="submitButton"
          class="w-full bg-green-900 hover:bg-green-800 text-white font-bold py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <span id="submitText">Create Profile</span>
          <svg
            class="spinner inline-block ml-2 w-5 h-5"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
        </button>

        <div
          id="successAlert"
          class="success-alert mt-4 p-4 rounded-md bg-green-50 border border-green-200"
        >
          <div class="text-green-800 flex items-center">
            <svg class="w-5 h-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path
                fill-rule="evenodd"
                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                clip-rule="evenodd"
              />
            </svg>
            Profile created successfully!
          </div>
        </div>
      </form>
    </div>

    <script type="module">
      // Import Firebase modules
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-analytics.js";
      import {
        getFirestore,
        collection,
        doc,
        setDoc,
      } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBjJg2gdxnpDAS4x0071TbOh0rO2NfiWRE",
        authDomain: "agrovestai.firebaseapp.com",
        projectId: "agrovestai",
        storageBucket: "agrovestai.appspot.com",
        messagingSenderId: "933337765267",
        appId: "1:933337765267:web:49a8e878e0750792b88466",
        measurementId: "G-5G75YCGQ0Y",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getFirestore(app);

      // Crops data
      const crops = [
        { value: "Maize", label: "Maize" },
        { value: "Cassava", label: "Cassava" },
        { value: "Rice", label: "Rice" },
        { value: "Sorghum", label: "Sorghum" },
        { value: "Yams", label: "Yams" },
        { value: "Millet", label: "Millet" },
        { value: "Plantain", label: "Plantain" },
        { value: "Cocoa", label: "Cocoa" },
        { value: "Palm Oil", label: "Palm Oil" },
        { value: "Groundnut", label: "Groundnut" },
        { value: "Soybean", label: "Soybean" },
        { value: "Cowpea", label: "Cowpea" },
        { value: "Rubber", label: "Rubber" },
        { value: "Cotton", label: "Cotton" },
        { value: "Ginger", label: "Ginger" },
      ];

      // Selected crops array
      let selectedCrops = [];

      // Populate crops
      const cropsContainer = document.getElementById("cropsContainer");
      crops.forEach((crop) => {
        const button = document.createElement("button");
        button.type = "button";
        button.className =
          "crop-button p-2 rounded-md text-left text-sm bg-white border border-gray-300 hover:bg-gray-50";
        button.innerHTML = `
            <div class="flex items-center">
              <span class="checkbox">
                <span class="check-icon">âœ“</span>
              </span>
              ${crop.label}
            </div>
          `;
        button.dataset.value = crop.value;

        button.addEventListener("click", () => {
          button.classList.toggle("selected");
          if (button.classList.contains("selected")) {
            selectedCrops.push(crop.value);
          } else {
            selectedCrops = selectedCrops.filter((v) => v !== crop.value);
          }
        });

        cropsContainer.appendChild(button);
      });

      // Form submission
      const form = document.getElementById("profileForm");
      const submitButton = document.getElementById("submitButton");
      const submitText = document.getElementById("submitText");
      const spinner = document.querySelector(".spinner");
      const successAlert = document.getElementById("successAlert");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        submitButton.disabled = true;
        submitText.textContent = "Submitting...";
        spinner.style.display = "inline-block";

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        data.crop_planted = selectedCrops;

        const userId = localStorage.getItem("userId");

        if (userId) {
          try {
            await setDoc(doc(db, "user_data", userId), data);

            submitButton.disabled = false;
            submitText.textContent = "Create Profile";
            spinner.style.display = "none";
            successAlert.style.display = "block";
            window.location.href = "dashboard.html";
            setTimeout(() => {
              successAlert.style.display = "none";
            }, 3000);
          } catch (error) {
            console.error("Error storing data:", error);
            submitButton.disabled = false;
            submitText.textContent = "Create Profile";
            spinner.style.display = "none";
          }
        } else {
          console.error("User ID not found in localStorage.");
          window.location.href = "signup.html";
          submitButton.disabled = false;
          submitText.textContent = "Create Profile";
          spinner.style.display = "none";
        }
      });
    </script>
  </body>
</html>
